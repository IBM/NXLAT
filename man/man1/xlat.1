.\" Automatically generated by Pandoc 3.1.3
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "xlat" "1" "November 25, 2025" "Version 1.0" "A Host-Based IPv4/IPv6 Translation Tool"
.hy
.SH NAME
.PP
xlat - A host-based IPv4/IPv6 translation tool using Jool kernel module.
.SH SYNOPSIS
.PP
\f[B]xlat\f[R] [\f[B]-h\f[R]|\f[B]\[en]help\f[R]] [\f[B]-v\f[R]]
[\f[B]command\f[R]] [\f[I]parameters\f[R]]
.SH OPTIONS
.TP
-h, --help
Show usage message.
.TP
-v
Verbose mode to print the configuration commands (iproute2,
iptables/ip6tables, jool_siit) executed.
.TP
\f[B]command\f[R]
One of the following commands.
.TP
\f[B]parameters\f[R]
Command-specific list of parameters.
.PP
\f[B]commands\f[R]:
.TP
\f[B]init\f[R] [\f[B]-h\f[R]|\f[B]\[en]help\f[R]] [\f[B]-conf\f[R] \f[I]CONF\f[R]]
Sets up XLAT environment using using the configuration file
(\f[I]CONF\f[R], default \f[B]/etc/xlat/xlat.yaml\f[R]).
.TP
\f[B]deinit\f[R] [\f[B]-h\f[R]|\f[B]\[en]help\f[R]] [\f[B]-conf\f[R] \f[I]CONF\f[R]]
Removes XLAT related configuration from the system including
ip/ip6tables and Jool EAMT rules using the configuration file
\f[I]CONF\f[R], default \f[B]/etc/xlat/xlat.yaml\f[R].
.TP
\f[B]load\f[R] [\f[B]-h\f[R]|\f[B]\[en]help\f[R]] [\f[B]-conf\f[R] \f[I]CONF\f[R]] [\f[B]-file\f[R] \f[I]FILE\f[R]]
Configures Jool EAMT entries from the hosts file \f[I]FILE\f[R], default
\f[B]/etc/hosts\f[R] and configuration file \f[I]CONF\f[R], default
\f[B]/etc/xlat/xlat.yaml\f[R].
.TP
\f[B]add\f[R] [\f[B]-h\f[R]|\f[B]\[en]help\f[R]] [\f[B]-conf\f[R] \f[I]CONF\f[R]] \f[B]-ipv4\f[R] \f[I]IPv4\f[R] \f[B]-ipv6\f[R] \f[I]IPv6\f[R]
Adds a Jool SIIT EAMT entry that maps an \f[I]IPv4\f[R] address to an
\f[I]IPv6\f[R] address using configuration file \f[I]CONF\f[R], default
\f[B]/etc/xlat/xlat.yaml\f[R].
.TP
\f[B]del\f[R] [\f[B]-h\f[R]|\f[B]\[en]help\f[R]] [\f[B]-conf\f[R] \f[I]CONF\f[R]] \f[B]-ipv4\f[R] \f[I]IPv4\f[R] \f[B]-ipv6\f[R] \f[I]IPv6\f[R]
Removes a Jool SIIT EAMT entry that maps an \f[I]IPv4\f[R] address to an
\f[I]IPv6\f[R] address using configuration file \f[I]CONF\f[R], default
\f[B]/etc/xlat/xlat.yaml\f[R].
.TP
\f[B]show\f[R] [\f[B]-h\f[R]|\f[B]\[en]help\f[R]] [\f[B]-conf\f[R] \f[I]CONF\f[R]] [\f[B]-ipv4\f[R] \f[I]IPv4\f[R]] [\f[B]-ipv6\f[R] \f[I]IPv6\f[R]]
Checks if a Jool SIIT EAMT entry exists using configuration file
\f[I]CONF\f[R], default \f[B]/etc/xlat/xlat.yaml\f[R].
Either \f[B]-ipv4\f[R] or \f[B]-ipv6\f[R] parameter is required.
.TP
\f[B]list\f[R] [\f[B]-h\f[R]|\f[B]\[en]help\f[R]] [\f[B]-conf\f[R] \f[I]CONF\f[R]] [\f[B]-format\f[R] \f[I]csv\f[R]] [\f[B]-nat|-filter\f[R]]
Prints Jool SIIT EAM table in tabular format by default and in CSV
format if \f[B]-format csv\f[R] is specified.
To list NAT (both DNAT and SNAT ip6tables rules) specify the
\f[B]-nat\f[R] flag and specify the \f[B]-filter\f[R] flag to list
ip/ip6tables filter rules.
Note that \f[B]-nat\f[R] and \f[B]-filter\f[R] flags are mutually
exclusive and \f[B]-format csv\f[R] is only useful to list EAMT rules
and not applicable to \f[B]-nat\f[R] or \f[B]-filter\f[R] options.
.TP
\f[B]gen\f[R] [\f[B]-h\f[R]|\f[B]\[en]help\f[R]] [\f[B]-conf\f[R] \f[I]CONF\f[R]] [\f[B]-v6zone\f[R] \f[I]zonefile\f[R]] [\f[B]-v6hosts\f[R] \f[I]hostsfile\f[R]] [\f[B]-domain\f[R] \f[I]domainname\f[R]] [\f[B]-hostsfile\f[R] \f[I]output\f[R]]
Generate the \f[I]/etc/hosts\f[R] file with both IPv4 and IPv6 addresses
from either from an IPv6 BIND9 authoritative forward zone file or from
an IPv6 only /etc/hosts file.
It assign IPv4 addresses to IPv6 hosts (IPv6 addresses come from the
input file) from the XLAT client IPv4 subnet configured in XLAT config
file.
.SH DESCRIPTION
.PP
A host-based IPv4/IPv6 translation on the servers listening on an IPv4
address on a dual-stack server physically connected to an IPv6 network.
It runs Jool SIIT kernel module inside a network namespace (SIIT).
IPTABLES DNAT rules are used to redirect incoming traffic to Jool SIIT
module for IPv6 to IPv4 translation, which uses private IPv6 and IPv4
addresses, and SNAT rules to set server\[cq]s public IPv6 address as the
source address to outgoing traffic.
It uses Jool EAMT rules to translate IPv6 addresses into IPv4 addresses
and vice-versa.
.SS Installation
.PP
RHEL 8.10 (Oopta) RPM package (nxlat-1.0-YYYYMMDD.el8.x86_64.rpm) is
built by compiling Jool source code (jool-4.1.14.tar.gz) downloaded from
https://www.jool.mx/en/download.html.
A Python script (xlat.py) is added to the package to help configure and
manage the servers for IPv6/IPv4 translation.
It depends on Python 3, iproute2, and iptables utilities.
To install this package use any RedHat package manager tool such as yum,
e.g., sudo yum install nxlat-1.0-YYYYMMDD.el8.x86_64.rpm.
It installs Jool kernel modules and Jool userspace utilities along with
the XLAT script.
.SS Configuration
.PP
The xlat utility uses a configuration file in YAML format.
The package comes with an example configuration file, which is installed
in /ect/xlat directory, default configuration file is
/ect/xlat/xlat.yaml.
The configuration file contains four sections: host, servers, clients,
and siit.
The \f[V]host\f[R] section specifies the server\[cq]s interface name via
which the server communicates with the clients.
We assume that servers are dual-stack servers, i.e., they use both IPv4
and IPv6 for communications.
So the interface is configured with both IPv4 and IPv6 addresses
(routable) and the services run on IPv4.
The \f[V]host\f[R] section of the configuration file also specifies the
port MTU and IPv4 and IPv6 addresses along with corresponding gateway
addresses as shown below:
.IP
.nf
\f[C]
host:
  port: enp7s0
  mtu: 9000
  ipv4addr: \[aq]192.168.100.104/24\[aq]
  ipv4gateway: \[aq]192.168.100.1\[aq]
  ipv6addr: \[aq]2001:db8:100::104/64\[aq]
  ipv6gateway: \[aq]2001:db8:100::1\[aq]
\f[R]
.fi
.PP
The \f[V]clients\f[R] section of the configuration file lists the IPv6
subnets of the clients, IPv6 subnets of the services running on the
client network.
We assume that all these subnets are reachable via the same IPv6 gateway
address specified in the \f[V]host\f[R] section.
In addition to IPv6 subnets, \f[V]clients\f[R] section also specifies a
private IPv4 subnet from which IPv4 addresses will be allocated to the
clients and other IPv6 servers on the client network.
These private IPv4 addresses will be used as the source addresses in
translated IPv4 packets.
Note that the server\[cq]s IPv4 address will be used as the destination
address in the translated IPv4 packets.
Furthermore, the \f[V]clients\f[R] section specifies the protocol (TCP)
and port numbers to reach the services on the client network as shown
below.
.IP
.nf
\f[C]
clients:
  ipv6-subnets: [\[aq]2001:db8:200::/64\[aq]]
  ipv4-subnet: \[aq]172.31.0.0/16\[aq]
  protocol: tcp
  svc-ports: [1234, 2345]
\f[R]
.fi
.PP
The \f[V]servers\f[R] section of the configuration file is used to
specify the protocol and ports of of the services on this server as
shown below:
.IP
.nf
\f[C]
servers:
  protocol: tcp
  svc-ports: [3456, 4567]
\f[R]
.fi
.PP
Finally, the \f[V]siit\f[R] section is used to specify XLAT
implementation internal parameters and is not related to the clients or
the servers and should be left as they come with the package.
Internal XLAT parameters include the name of the Linux network namespace
to run Jool in, Linux veth pair names to connect the namespace to the
host IPv6 network, Linux veth pair names to connect the namespace to the
host IPv4 network, two private IPv6 and two private IPv4 addresses to
configure on these virtual ports, where the \f[I]ipvXaddrs\f[R] are
configured inside the namespace and \f[B]ipvXgateways\f[R] are
configured outside the namespace.
.IP
.nf
\f[C]
siit:
  name: SIIT
  veth_out: siit6
  veth_out_peer: siit6p
  veth_in: siit4
  veth_in_peer: siit4p
  ipv4addr: \[aq]192.168.255.1/30\[aq]
  ipv4gateway: \[aq]192.168.255.2\[aq]
  ipv6addr: \[aq]fd00:ab:cd::1/64\[aq]
  ipv6gateway: \[aq]fd00:ab:cd::2\[aq]
\f[R]
.fi
.SS EXAMPLES
.PP
Once a configuration is created with correct configuration parameters,
initialize the XLAT SIIT by running xlat.py init as follows.
.IP
.nf
\f[C]
# sudo /usr/local/bin/xlat.py init -conf xlat.yaml
\f[R]
.fi
.PP
Note that \f[V]xlat\f[R] by default uses /etc/xlat/xlat.yaml as its
configuration file, so you do not have to specify -conf every time you
run xlat tool.
Besides, you could use the verbose (-v) option as xlat.py -v init to see
how it configures Jool SIIT.
If the configurations are correct, init should finish with
\[ga]DONE!\[cq] message, which indicates that the XLAT setup is
complete.
.IP
.nf
\f[C]
# xlat.py init
DONE!
\f[R]
.fi
.PP
You could run the \f[V]xlat list\f[R] command to see the Jool
translation rules as follows:
.IP
.nf
\f[C]
# xlat.py list
+---------------------------------------------+--------------------+
|                                 IPv6 Prefix |        IPv4 Prefix |
+---------------------------------------------+--------------------+
|                           fd00:ab:cd::2/128 |   192.168.255.2/32 |
|                           fd00:ab:cd::1/128 | 192.168.100.104/32 |
+---------------------------------------------+--------------------+
\f[R]
.fi
.PP
You could also run \f[V]xlat list -nat\f[R] command to see the iptables
NAT rules that configured on the system as shown below:
.IP
.nf
\f[C]
# xlat.py list -nat
[0:0] -A PREROUTING -i enp7s0 -p tcp -m tcp --dport 3456 -j DNAT --to-destination fd00:ab:cd::1
[0:0] -A PREROUTING -i enp7s0 -p tcp -m tcp --sport 4567 -j DNAT --to-destination fd00:ab:cd::1
[0:0] -A POSTROUTING -o enp7s0 -p tcp -m tcp --dport 1234 -j SNAT --to-source 2001:db8:100::104
[0:0] -A POSTROUTING -o enp7s0 -p tcp -m tcp --dport 2345 -j SNAT --to-source 2001:db8:100::104
\f[R]
.fi
.PP
Finally, you run \f[V]xlat list -filter\f[R] command to see the iptables
rules (mangle) that are configured for Jool SIIT translation:
.IP
.nf
\f[C]
# xlat.py list -filter
Chain PREROUTING (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source     destination         
    0     0 JOOL_SIIT  all  --  siit4p *       0.0.0.0/0  0.0.0.0/0    instance:default
Chain PREROUTING (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out  source  destination         
    0     0 JOOL_SIIT  tcp      siit6p *    ::/0    ::/0         tcp dpt:3456 instance:default
    0     0 JOOL_SIIT  tcp      siit6p *    ::/0    ::/0         tcp dpt:4566 instance:default
    0     0 JOOL_SIIT  tcp      siit6p *    ::/0    ::/0         tcp spt:1234 instance:default
    0     0 JOOL_SIIT  tcp      siit6p *    ::/0    ::/0         tcp spt:2345 instance:default
\f[R]
.fi
.SS Configuring Explicit Address Mapping Table (EAMT) Entries
.PP
To add an EAMT entry for a given IPv6 and IPv4 address pair, run xlat.py
add command as follows:
.IP
.nf
\f[C]
# xlat.py add -ipv6 2001:db8:200::102 -ipv4 172.31.0.102
\f[R]
.fi
.PP
and the updated Jool EAMT with a new entry is shown below:
.IP
.nf
\f[C]
# xlat.py list
+---------------------------------------------+--------------------+
|                                 IPv6 Prefix |        IPv4 Prefix |
+---------------------------------------------+--------------------+
|                       2001:db8:200::102/128 |    172.31.0.102/32 |
|                           fd00:ab:cd::2/128 |   192.168.255.2/32 |
|                           fd00:ab:cd::1/128 | 192.168.100.104/32 |
+---------------------------------------------+--------------------+
\f[R]
.fi
.PP
Note that the IPv6 address must come from the clients\[cq] IPv6 subnets
and the IPv4 address must be from the clients\[cq] IPv4 subnet.
.PP
You could remove an EAMT entry by running \f[V]xlat del\f[R] command as
follow:
.IP
.nf
\f[C]
# xlat.py del -ipv6 2001:db8:200::102 -ipv4 172.31.0.102
\f[R]
.fi
.PP
and the updated Jool EAMT is shown below:
.IP
.nf
\f[C]
# xlat.py list
+---------------------------------------------+--------------------+
|                                 IPv6 Prefix |        IPv4 Prefix |
+---------------------------------------------+--------------------+
|                           fd00:ab:cd::2/128 |   192.168.255.2/32 |
|                           fd00:ab:cd::1/128 | 192.168.100.104/32 |
+---------------------------------------------+--------------------+
\f[R]
.fi
.PP
Since the solution requires DNS name and address resolution, we use EAMT
rules for each IPv4/IPv6 address translation instead of letting Jool to
automatically generating an IPv4/IPv6 mapping from a given pool.
For DNS name/address resolution, we use \f[V]dnsmasq\f[R] with
\f[V]/etc/hosts\f[R] file for simplicity.
So we have to populate the \f[V]/etc/hosts\f[R] files on each servers
with all the clients\[cq] names and IPv6 addresses as well as allocating
a private IPv4 address from the clients IPv4 subnet configured in the
xlat configuration file.
Once the \f[V]/etc/hosts\f[R] file has been populated with all the
clients and external servers names and IPv4 and IPv6 addresses, you
could configure Jool EAMT rules automatically by using
\f[V]xlat load\f[R] command.
Suppose, we have the following entries in the /etc/hosts file:
.IP
.nf
\f[C]
# cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
172.31.0.101 client101.xlat.net
2001:db8:200::101 client101.xlat.net
172.31.0.102 client102.xlat.net
2001:db8:200::102 client102.xlat.net
\f[R]
.fi
.PP
then \f[V]xlat load\f[R] command will add two entries into Jool EAM
table as shown below.
.IP
.nf
\f[C]
# xlat.py load
# xlat.py list
+---------------------------------------------+--------------------+
|                                 IPv6 Prefix |        IPv4 Prefix |
+---------------------------------------------+--------------------+
|                       2001:db8:200::102/128 |    172.31.0.102/32 |
|                       2001:db8:200::101/128 |    172.31.0.101/32 |
|                           fd00:ab:cd::2/128 |   192.168.255.2/32 |
|                           fd00:ab:cd::1/128 | 192.168.100.104/32 |
+---------------------------------------------+--------------------+
\f[R]
.fi
.SS Generating /etc/hosts file from IPv6 only /etc/hosts file or from BIND9 IPv6 forward zone file
.PP
As we assume clients resides in an IPv6 only network, they do not have
IPv4 addresses assigned to them but to communicate with the servers
running in IPv4 networks, they need IPv4 addresses.
So we assign a synthetic (private) IPv4 address to each of the client
that corresponds to their IPv6 address and hostname.
In order to simplify the IPv4 address assignment, XLAT script provides
\f[I]gen\f[R] command which takes either an IPv6 BIND9 forward zone file
(with a single domain) or an IPv6 only /etc/hosts file as input and
generates an /etc/hosts file with both IPv4 and IPv6 addresses.
Note that it allocates IPv4 addresses sequentially from the client IPv4
subnet specified in the XLAT config file.
The limitations are it uses a single IPv4 subnet and assumes a single
domain name in the zone file.
It should be used once to generate the /etc/hosts file to ensure a
unique IPv4 address is assigned to each IPv6 host.
.PP
To generate /etc/hosts file from a BIND9 IPv6 forward zone file, run the
following command:
.IP
.nf
\f[C]
# xlat.py gen -v6zone /path/to/zonefile -domain ipv6test.net -hostsfile hosts
\f[R]
.fi
.PP
To generate /etc/hosts file from a IPv6 only hosts file, run the
following command:
.IP
.nf
\f[C]
# xlat.py gen -v6host /path/to/hostsfile -hostsfile hosts
\f[R]
.fi
.PP
By the default it appends hosts entries to /etc/hosts file otherwise
copy the generated hosts file to /etc/ directory and restart the
\f[V]dnsmasq\f[R] service for name resolution.
Note that you have to configure Jool EAMT entries using this hosts file
as described in the previous section.
.SH DISCLAIMER
.PP
It uses the open source Jool software (unmodified version jool-4.1.14)
downloaded from the Network Information Centre Mexico (NIC Mexico)
website https://www.jool.mx.
.SH COPYRIGHT
.PP
Copyright (C) 2025 IBM Corporation.
.SH AUTHORS
Abdul Alim, Anand Singh, and Bengi Karacali. IBM Research. Contact:
malim\[at]us.ibm.com.
